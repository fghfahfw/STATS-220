# Load packages
library(tidyverse)
library(stringr)
library(lubridate)

# Load data
logged_data <- read_csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vSqmNsKYk1tMRtLGm7GnGLojZjwW9nCLYFmr2DA3MvlzBT6G-bhwo1TOtyQwr6MsO40BNOCKxhI9qG0/pub?output=csv")

# Rename columns
latest_data <- logged_data %>%
  rename(
    date = 1,
    outcome = 2,
    total_amount_spent = 3,
    spending_flag = 4
  ) %>%
  mutate(
    total_amount_spent = str_remove_all(total_amount_spent, "[^\\d\\.]"),  # clean the letter that not number
    total_amount_spent = as.numeric(total_amount_spent),
    date = paste0(date, "2025"),      
    date = dmy(date),                  
    weekday = wday(date, label = TRUE) 
  )

# Plot 1: Total Spending per Day
plot1 <- latest_data %>%
  group_by(date) %>%
  summarise(daily_spent = sum(total_amount_spent, na.rm = TRUE)) %>%
  ggplot(aes(x = date, y = daily_spent)) +
  geom_col(fill = "#ece7f2") +
  labs(
    title = "Total Spending Per Day",
    x = "Date",
    y = "Total Amount Spent"
  ) +
  theme_minimal()

ggsave("plot1.png", plot1, width = 8, height = 5)

# Plot 2: Frequency of "shopping" in Outcome
plot2 <- latest_data %>%
  mutate(shopping_count = str_count(str_to_lower(outcome), "shopping")) %>%
  group_by(date) %>%
  summarise(mentions = sum(shopping_count, na.rm = TRUE)) %>%
  ggplot(aes(x = date, y = mentions)) +
  geom_line(color = "#a6bddb", size = 1) +
  labs(
    title = "Mentions of 'shopping' in Outcome Over Time",
    x = "Date",
    y = "Mentions"
  ) +
  theme_minimal()

ggsave("plot2.png", plot2, width = 8, height = 5)

# Plot 3: Spending Distribution by Weekday
plot3 <- latest_data %>%
  filter(!is.na(total_amount_spent)) %>%
  ggplot(aes(x = weekday, y = total_amount_spent)) +
  geom_boxplot(fill = "#2b8cbe") +
  labs(
    title = "Spending Distribution by Weekday",
    x = "Weekday",
    y = "Total Amount Spent"
  ) +
  theme_minimal()

ggsave("plot3.png", plot3, width = 8, height = 5)
